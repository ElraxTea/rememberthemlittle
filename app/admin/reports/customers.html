<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/_system/css/proxima.woff2.css">
  <link rel="stylesheet" href="/_system/css/playfulcss/playfulcss.css">
  <link rel="stylesheet" href="/_system/css/fontawesome-free-5.3.1-web/css/all.min.css">

  <!-- Page Title -->
  <title>Document</title>

</head>

<body>

  <!--
    The Vue instance runs inside this <div id="app">.
    Also, the class="admin" loads the admin style for this page.
      -->
  <div id="app" class="admin">

    <!-- Navigation Bar-->
    <nav>

      <!-- Company Logo -->
      <h3>Remember Them Little</h3>

      <!-- Navigation Links -->
      <ul>
        <li><a href="#">Link</a></li>
        <li><a href="#">Link</a></li>
        <li><a href="#">Link</a></li>
      </ul>

    </nav>

    <!-- Side Navigation Bar -->
    <aside>
      <ul>
        <li><a href="sales.html">Sales</a></li>
        <li><a href="bookings.html">Bookings</a></li>
        <li><a href="customers.html" class="color-primary">Customers</a></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main>

      <!-- Action bar -->
      <div>
        <h3>Customer List</h3>
        <!--<button class="primary" @click="$root.$refs.add.show()">Add Packages</button>-->
      </div>

      <!-- Table -->
      <input type="text" v-model="$root.input_name">
      <input type="date" v-model="$root.selected_date_from">
      <input type="date" v-model="$root.selected_date_to">
      <table>

        <!-- Table headers -->
        <thead>
          <tr>
            <th>Date Created</th>
            <th>Name</th>
            <th>Facebook</th>
            <th>Contact</th>
            <th>Last Booking Transaction</th>
          </tr>
        </thead>

        <!-- Table body -->
        <tbody>
          <tr v-for="customer in containedNames">
            <td>{{customer.account_created}}</td>
            <td>{{customer.account_name}}</td>
            <td>{{customer.account_fb}}</td>
            <td>{{customer.account_contact}}</td>
            <td>{{customer.last_booking}}</td>
          </tr>
        </tbody>
      </table>

    </main>


  </div>

  <!-- Imported Scripts -->
  <script src="/_system/js/vendor/vue.js"></script>
  <script src="/_system/js/components/components.js"></script>
  <script src="/_system/js/vendor/vue-resource@1.5.1.js"></script>

  <!-- Local Scripts -->
  <script>

    // Vue Instance
    var app = new Vue({
      el: '#app',
      data: {
        customers: [
          {
            account_created: "2018-01-28",
            account_name: "CarlJason",
            account_fb: "Infant",
            account_contact: "09753153895",
            last_booking: "2018-1-28"
          },
          {
            account_created: "2018-02-28",
            account_name: "CarlJason",
            account_fb: "New Born",
            account_contact: "09753153895",
            last_booking: "2018-3-28"
          },
          {
            account_created: "2018-03-28",
            account_name: "CarlJason",
            account_fb: "Infant",
            account_contact: "09753153895",
            last_booking: "2018-4-28"
          },
        ],
        selected_date_from: '',
        selected_date_to: '',
        input_name: ''
      },
      computed: {
        containedNames(){
          return this.customers.filter(
            customer => 
              (customer.account_name.toLowerCase().includes(this.input_name.toLowerCase())
          || customer.account_fb.toLowerCase().includes(this.input_name.toLowerCase()) || this.input_name == "")
           && 
           (
             ((Date.parse(customer.account_created) >= Date.parse(this.selected_date_from)) || this.selected_date_from == "") && 
             ((Date.parse(customer.account_created) <= Date.parse(this.selected_date_to)) || this.selected_date_to == ""))
           );
          },
      },
      created: function () {
        this.loadPackages();
        this.loadCategories();
      },
      methods: {

        loadPackages: function () {

          Vue.http.get('/_system/php/api/packages/getAll.php')
            .then(
              response => {

                if (response.body.success)
                  this.packages = response.body.data;
                else
                  console.error(response.body.message);
              },
              response => {
                console.log('fail');
              });
        },

        addPackage: function (submitEvent) {

          var elements = submitEvent.target.elements;
          var formData = new FormData();
          formData.append('package_name', elements.package_name.value);
          formData.append('package_description', elements.package_description.value);
          formData.append('category_id', elements.category_id.value);
          formData.append('package_price', elements.package_price.value);
          formData.append('package_minutes', elements.package_minutes.value);
          formData.append('package_themes', elements.package_themes.value);
          formData.append('package_active', elements.package_active.checked ? 1 : 0);

          Vue.http.post('/_system/php/api/packages/add.php', formData)
            .then(

              // If the server request is successful
              response => {

                // If the PHP file has no errors
                if (response.body.success) {
                  this.loadPackages();
                }
                else
                  console.error(response.body.message)

              },

              // If the server request is unsuccessful
              response => {

                console.error(response);

              });

        },

        updatePackage: function (package_id, submitEvent) {

          var elements = submitEvent.target.elements;
          var formData = new FormData();
          formData.append('package_id', package_id);
          formData.append('package_name', elements.package_name.value);
          formData.append('package_description', elements.package_description.value);
          formData.append('category_id', elements.category_id.value);
          formData.append('package_price', elements.package_price.value);
          formData.append('package_minutes', elements.package_minutes.value);
          formData.append('package_themes', elements.package_themes.value);
          formData.append('package_active', elements.package_active.checked ? 1 : 0);

          Vue.http.post('/_system/php/api/packages/update.php', formData)
            .then(

              // If the server request is successful
              response => {

                // If the PHP file has no errors
                if (response.body.success) {
                  this.loadPackages();
                }
                else
                  console.error(response.body.message)

              },

              // If the server request is unsuccessful
              response => {

                console.error(response);

              });

        },

        deletePackage: function (package_id) {

          var formData = new FormData();
          formData.append('package_id', package_id);

          Vue.http.post('/_system/php/api/packages/delete.php', formData)
            .then(

              // If the server request is successful
              response => {

                // If the PHP file has no errors
                if (response.body.success) {
                  this.loadPackages();
                }
                else
                  console.error(response.body.message)

              },

              // If the server request is unsuccessful
              response => {

                console.error(response);

              });

        },

        loadCategories: function () {

          Vue.http.get('/_system/php/api/categories/getAll.php')
            .then(
              response => {

                if (response.body.success)
                  this.categories = response.body.data;
                else
                  console.error(response.body.message);
              },
              response => {
                console.log('fail');
              });
        }
      }
    })

  </script>


</body>

</html>