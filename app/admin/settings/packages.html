<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/_system/css/proxima.woff2.css">
  <link rel="stylesheet" href="/_system/css/playfulcss/playfulcss.css">
  <link rel="stylesheet" href="/_system/css/fontawesome-free-5.3.1-web/css/all.min.css">

  <!-- Page Title -->
  <title>Document</title>

</head>

<body>

  <!--
    The Vue instance runs inside this <div id="app">.
    Also, the class="admin" loads the admin style for this page.
      -->
  <div id="app" class="admin">

    <!-- Navigation Bar-->
    <nav>

      <!-- Company Logo -->
      <h3>Remember Them Little</h3>

      <!-- Navigation Links -->
      <ul>
        <li><a href="/app/admin/transactions/">Transactions</a></li>
        <li><a href="/app/admin/settings/">Settings</a></li>
        <li><a href="#">Link</a></li>
      </ul>

    </nav>

    <!-- Side Navigation Bar -->
    <aside>
      <ul>
        <li><a href="index.html">Categories</a></li>
        <li><a href="packages.html" class="color-primary">Packages</a></li>
        <li><a href="addons.html">Addons</a></li>
        <li><a href="themes.html">Themes</a></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main>

      <!-- Action bar -->
      <div>
        <h3>Packages</h3>
        <button class="primary" @click="$root.$refs.add.show()">Add Packages</button>
      </div>

      <!-- Table -->
      <table>

        <!-- Table headers -->
        <thead>
          <tr>
            <th>Name</th>
            <th>Category</th>
            <th>Description</th>
            <th>Price</th>
            <th>Minutes</th>
            <th>Themes</th>
            <th>Active</th>
            <th>Action</th>
          </tr>
        </thead>

        <!-- Table body -->
        <tbody>
          <tr v-for="package in packages">
            <td>{{package.package_name}}</td>
            <td>{{$root.categories.find(category => category.category_id === package.category_id).category_name}}</td>
            <td>{{package.package_description}}</td>
            <td>{{package.package_price}}</td>
            <td>{{package.package_minutes}}</td>
            <td>{{package.package_themes}}</td>
            <td>{{package.package_active == 1 ? 'Yes' : 'No'}}</td>
            <td><a @click.prevent="$root.$refs.edit.show(package)" class="color-primary">Edit</a></td>
          </tr>
        </tbody>
      </table>

    </main>

    <modal class="modal" inline-template ref="add">

      <!-- Add Package form-->
      <form v-if="visible" @submit.prevent="$root.addPackage($event); hide();">

        <fieldset>

          <!-- Form Title -->
          <legend>New Package</legend>
          <div class="flex">
            <div class="flex column" style="margin-right: 0.5rem">
              <label>Category</label>
              <select name="category_id">
                <option v-for="(category,index) in $root.categories" :value="category.category_id">{{category.category_name}}</option>
              </select>

              <label>Package Price</label>
              <input type="number" name="package_price" required>

              <label>Package Description</label>
              <textarea style="height: 100px" name="package_description" required></textarea>
            </div>
            <div class="flex column">

              <label>Package Name</label>
              <input type="text" name="package_name" required>

              <label>Package Minutes</label>
              <input type="number" name="package_minutes" required>

              <label>Package Themes</label>
              <input type="number" name="package_themes" required>

              <label><input type="checkbox" name="package_active" checked>&nbspActive</label>
            </div>
            <div class="flex column">
              <label>Inclusions</label>
              <div class="flex align-items-center">
                <select style="margin: 0" id="addon">
                  <option v-for="addon in $root.addons" :value="addon.addon_id">{{addon.addon_type}} -
                    {{addon.addon_description}}</option>
                </select>
                <a class="button" onclick="app.chosen_addons.push(parseInt(document.querySelector('#addon').value))">Add</a>
              </div>
              <table style="margin-left: 1rem">
                <tr v-for="addon_id,index in $root.chosen_addons">
                  <td>{{addon_id}}: {{$root.getAddonObject(addon_id).addon_description}}</td>
                  <td><a @click="$root.chosen_addons.splice(index,1)">Remove</a></td>
                </tr>
              </table>
            </div>
          </div>
          <!-- Form action buttons -->
          <div class="flex align-items-center">
            <button @click.prevent="hide">Cancel</button>
            <button type="submit" class="primary" style="margin-left: 0.5rem">Add Package</button>
          </div>

        </fieldset>
      </form>

    </modal>

    <modal class="modal" inline-template ref="edit">

      <!-- Edit Category form -->
      <form v-if="visible" @submit.prevent="$root.updatePackage(params.package_id,$event); hide();">

        <fieldset>

          <legend>Edit Package</legend>
          <div class="flex">
            <div class="flex column" style="margin-right: 0.5rem">
              <label>Category</label>
              <select name="category_id">
                <option v-for="(category,index) in $root.categories" :value="category.category_id" :selected="(params.category_id == category.category_id)">{{category.category_name}}</option>
              </select>

              <label>Package Price</label>
              <input type="number" name="package_price" required :value="params.package_price">

              <label>Package Description</label>
              <textarea style="height: 100px" name="package_description" required :value="params.package_description"></textarea>


            </div>
            <div class="flex column">

              <label>Package Name</label>
              <input type="text" name="package_name" :value="params.package_name" required>


              <label>Package Minutes</label>
              <input type="number" name="package_minutes" required :value="params.package_minutes">

              <label>Package Themes</label>
              <input type="number" name="package_themes" required :value="params.package_themes">

              <label><input type="checkbox" name="package_active" :checked="(params.package_active)">&nbspActive</label>
            </div>
          </div>
          <!-- Action buttons -->
          <div class="flex align-items-center">
            <button @click.prevent="hide">Cancel</button>
            <button @click.prevent="$root.deletePackage(params.package_id); hide();" style="margin-left: 0.5rem">Delete</button>
            <button type="submit" class="primary" style="margin-left: 0.5rem">Update</button>
          </div>

        </fieldset>
      </form>

    </modal>

  </div>

  <!-- Imported Scripts -->
  <script src="/_system/js/vendor/vue.js"></script>
  <script src="/_system/js/components/components.js"></script>
  <script src="/_system/js/vendor/vue-resource@1.5.1.js"></script>

  <!-- Import Mixins -->
  <script src="/_system/js/mixins/packages.js"></script>
  <script src="/_system/js/mixins/categories.js"></script>
  <script src="/_system/js/mixins/addons.js"></script>

  <!-- Local Scripts -->
  <script>

    // Vue Instance
    var app = new Vue({

      mixins: [PackageMethods, CategoryMethods, AddonMethods],

      el: '#app',
      data: {
        packages: [],
        categories: [],
        addons: [],
        chosen_addons: [],
      },
      created: function () {
        this.loadPackages();
        this.loadCategories();
        this.loadAddons();
      },
      methods: {

        getAddonObject: function (addon_id) {


          for (var i = 0; i < this.addons.length; i++) {
            if (this.addons[i].addon_id == addon_id) {
              return this.addons[i];
            }
          }


        }
        ,

      }
    })

  </script>


</body>

</html>